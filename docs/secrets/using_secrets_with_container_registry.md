# Using Secrets with Container Registries

As you advance on the Blueprint platform, you may want to write and serve your own containers with Blueprints. Since Blueprints is largely container agnostic and supports most features associated with container deployments, developing your own custom container is straightforward. Take, for example, the following Dockerfile:

```docker
FROM python:3.10-alpine

RUN pip3 install huggingface_hub

ENTRYPOINT ["huggingface-cli", "download"]
```

This file runs the `huggingface-cli download` subcommand (duh), which can download a model or dataset to a specified location. Given this, we can easily build a docker image and push this to a container repository. I will use Oracle Container Repositories as an example, but this also works with docker or any place you want to host private containers. Following the documentation to [create a repository](https://docs.oracle.com/en-us/iaas/Content/Registry/Tasks/registrycreatingarepository.htm#top) and to [login with docker](https://docs.oracle.com/en-us/iaas/Content/Registry/Tasks/registrypushingimagesusingthedockercli.htm), I'd do the following to push the image to my private repository:

```bash
docker login iad.ocir.io
Username: iduyx1qnmway/dennis.kennetz@oracle.com
Password: <password is the auth token generated by following the linked doc>
```

**Note**: iad.ocir.io is region specific to Ashburn. Each region has a dedicated endpoint that you log into, so if you are not in Ashburn, that will change. 

Given the dockerfile above as `Dockerfile` in this directory, we can do (this is my private repo):
```
sudo docker build -t iad.ocir.io/iduyx1qnmway/dktest/hfdownloader:v1
sudo docker push iad.ocir.io/iduyx1qnmway/dktest/hfdownloader:v1
```

Note: If the push failed, review that you were able to login successfully and you have [correct policies](https://docs.oracle.com/en-us/iaas/Content/Registry/Concepts/registrypolicyrepoaccess.htm#Policies_to_Control_Repository_Access) for pushing to your repo.


### Using the container

Now that the container is in our private repo, we need to store the `container_registry` credentials as a secret in Blueprints by posting [this secret](container_registry_secret.json) to the `/secrets/` endpoint of your assigned API endpoint (e.g. https://api.<ip>.nip.io from your stack after deployment). Change the name, tenancy information, and email. The `"password"` field should be the auth token generated earlier.

Upon posting, a successful response looks like:
```json
{
    "operations_processed": 1,
    "results": [
        {
            "action": "create",
            "name": "iad-creds",
            "namespace": "default",
            "status": "success",
            "message": "Secret 'iad-creds' created successfully"
        }
    ]
}
```
And the secret should show in your API console at `/secrets` like:
```json
...
    {
        "name": "iad-creds",
        "namespace": "default",
        "type": "kubernetes.io/dockerconfigjson",
        "data_keys": [
            ".dockerconfigjson"
        ],
        "creation_timestamp": "2025-07-11 07:00 AM UTC"
    },
...
```
Finally, with the credentials stored, you can use them to pull from your container registry. Upon referencing [api docs](../api_documentation.md), we can see all the valid fields for the `/deployment` endpoint to create a simple blueprints to download data to object storage leveraging our new `hfdownloader:v1` container.

We will download the model to object storage, and currently Blueprints does not support the creation of object storage buckets. I have made one called `testmodel` where I will download my model to.

Following the CLI arguments available with [huggingface download](https://huggingface.co/docs/huggingface_hub/main/en/guides/cli#huggingface-cli-download), I created [this blueprint](./hf_downloader.json) from the [api docs](../api_documentation.md) which runs a job on an E4.Flex cpu based VM with 4 cpus and 64GB of RAM using 4 workers in the cli to download the open model `NousResearch/Meta-Llama-3.1-8B-Instruct` to object storage.

Post the blueprint to the `/deployment` endpoint which will run a job to download the model and copy it to object storage. Upon completion, the model weights should be present in `testmodel` created earlier.